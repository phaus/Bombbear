@(message: String)

@main("Welcome to Bombbear!") {
	<script type="text/javascript">
    enchant(); // initialize
    var game = new Core(800, 600); // game stage
    game.preload('/assets/images/chara1.png'); // preload image
    game.preload('/assets/images/map0.png'); // preload image
    game.fps = 20;
    var map = new Map(32, 32);
    var size = 32;
    game.onload = function(){
 // Obstacle Detection on Maps

map.image = game.assets['/assets/images/map0.png'];
var mapa = [
  [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
  [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
  [  0,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  0,  0],
  [  0,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  0],
  [  0,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  0],
  [  0,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  0],
  [  0,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  0],
  [  0,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  0],
  [  0,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  0],
  [  0,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  0],
  [  0,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  0],
  [  0,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  0,  0],
  [  0,  2,  2,  2,  2,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
  [  0,  2,  2,  2,  2,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
  [  0,  2,  2,  2,  2,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
  [  0,  2,  2,  2,  2,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0]
];
map.loadData(mapa);

var colMap = [
  [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
  [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
  [  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0],
  [  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0],
  [  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0],
  [  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0],
  [  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0],
  [  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0],
  [  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0],
  [  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0],
  [  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0],
  [  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0],
  [  0,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
  [  0,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
  [  0,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
  [  0,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0]
];
map.collisionData = colMap;
 
if (map.hitTest(100,100) === true) {
  console.log('hit');
}
var Player = enchant.Class.create(enchant.Sprite, {
    initialize: function(){
        enchant.Sprite.call(this, size, size);
        this.image = game.assets['/assets/images/chara1.png'];
        this.frame = [6, 6, 7, 7];                   // set image data
        game.rootScene.addChild(this);     // add to canvas
    }
});

var move_direction = null;
 
game.rootScene.addChild(map);
        
        bear.image = game.assets['/assets/images/chara1.png'];
        game.rootScene.addChild(bear);
        bear.frame = [6, 6, 7, 7];   // select sprite frame
        
        /*
        bear.tl.moveBy(200, 0, 90)   // move right
            .scaleTo(-1, 1, 1)      // turn left
            .moveBy(-200, 0, 90)     // move left
            .scaleTo(1, 1, 1)  ;     // turn right
          */  //.loop();                 // loop it
    };
    game.rootScene.on('downbuttondown', function(evt){
    	move_direction=('down');
    	move();
    });
    game.rootScene.on('downbuttonup', function(evt){
    	move_direction='stop';
    	move();
    	move_finish('down');
    });
    game.rootScene.on('upbuttondown', function(evt){
    	
    	move_direction=('up'); 
    	move();
    });
    game.rootScene.on('upbuttonup', function(evt){
    	move_direction='stop';
    	move();
    	move_finish('up');
    });
    
    
    game.rootScene.on('leftbuttondown', function(evt){
    	move_direction=('left');
    	move(size);
    });
    game.rootScene.on('leftbuttonup', function(evt){
    	move_direction='stop';
    	move(size);
    	move_finish('left');
    });
    game.rootScene.on('rightbuttondown', function(evt){
    	
    	move_direction=('right');
    	move(size);
    	
    });
    game.rootScene.on('rightbuttonup', function(evt){
    	move_direction='stop';
    	move(size);
    	move_finish('right');
    });
    
    function move(movement){
    	
    	bear.tl.resume();
    	switch (move_direction){
    		case 'up':{
    			if (bear.y % size == 0)  movement = size ; else movement = size - bear.y % size;
    			if (map.hitTest(bear.x,bear.y-size) !== true ) bear.tl.moveBy(0,- size,4) ;
    			break;
    		}
    		case 'down':{
    			if (bear.y % size == 0)  movement = size ; else movement = size - bear.y % size;
    			if (map.hitTest(bear.x,bear.y+size) !== true ) bear.tl.moveBy(0,size,4) ;
    			break;
    		}
    		case 'left':{
    			if (bear.x % size == 0)  movement = size ; else movement = size - bear.x % size;
    			if (map.hitTest(bear.x-size,bear.y) !== true ) bear.tl.scaleTo(-1, 1, 1).moveBy(-size,0,4) ;
    			break;
    		}
    		case 'right':{
    			if (bear.x % size == 0)  movement = size ; else movement = size - bear.x % size;
    			if (map.hitTest(bear.x+size,bear.y) !== true ) bear.tl.scaleTo(1, 1, 1).moveBy(size,0,4) ;
    			break;
    		}
    		case 'stop':{
    			bear.tl.clear();
    			break;
    		}
    	}
    }
    
    function move_finish(direction){
    	
    	var movement = size;
    	switch (direction){
    		case 'up':{
    			if (bear.y % size == 0)  movement = size ; else movement = size - bear.y % size;
    			if (map.hitTest(bear.x,bear.y-size) !== true ) bear.tl.moveBy(0,- movement,0) ;
    			break;
    		}
    		case 'down':{
    			if (bear.y % size == 0)  movement = size ; else movement = size - bear.y % size;
    			if (map.hitTest(bear.x,bear.y+size) !== true ) bear.tl.moveBy(0,movement,0) ;
    			break;
    		}
    		case 'left':{
    			if (bear.x % size == 0)  movement = size ; else movement = size - bear.x % size;
    			if (map.hitTest(bear.x-size,bear.y) !== true ) bear.tl.scaleTo(-1, 1, 1).moveBy(-movement,0,0) ;
    			break;
    		}
    		case 'right':{
    			if (bear.x % size == 0)  movement = size ; else movement = size - bear.x % size;
    			if (map.hitTest(bear.x+size,bear.y) !== true ) bear.tl.scaleTo(1, 1, 1).moveBy(movement,0,0) ;
    			break;
    		}
    		
    	}
    }
    
    
    
    game.start(); // start your game!
    var bear = new Sprite(32, 32);  
    
    var player = new Player();
    
   // game.rootScene.on('touchmove', function(evt){
    //    player.y = evt.localY;    // set position to touch-y position
   // });
    function buttonclick(){
    	console.log("ububbu");
    	var map = new Map(32, 32);
    	map.image = game.assets['/assets/images/map0.png'];
    	  var map2 = [
    	  [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
    	  [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
    	  [  0,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  0,  0],
    	  [  0,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  0],
    	  [  0,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  0],
    	  [  0,  2,  2,  1,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  0],
    	  [  0,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  0],
    	  [  0,  2,  2,  1,  2,  2,  2,  2,  1,  1,  2,  2,  2,  2,  2,  0],
    	  [  0,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  0],
    	  [  0,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  0],
    	  [  0,  2,  2,  1,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  0],
    	  [  0,  2,  2,  2,  2,  2,  1,  2,  2,  2,  1,  2,  2,  2,  0,  0],
    	  [  0,  2,  2,  1,  2,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
    	  [  0,  2,  2,  2,  2,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
    	  [  0,  2,  2,  2,  2,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
    	  [  0,  2,  2,  2,  2,  2,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0]
    	];
    	map.loadData(map2);
    	 var scene = new Scene();
    	  scene.addChild(map);
    	  
    	   game.currentScene.removeChild(map);
    	  game.currentScene.addChild(map);
    	  game.currentScene.addChild(bear);
    	//game.currentScene.addChild(c);
    	}
        </script>
}


